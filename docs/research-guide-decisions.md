# Research Guide 기능 — 설계 의사결정 기록

이 문서는 Research Guide 기능의 설계 과정에서 이루어진 사용자-어시스턴트 간 의사결정 대화를 정리한 것이다. 원본은 Claude Code 세션 `ee98511d-62d1-44cf-b723-c62a99ef28a5`에서 추출했다.

---

## 1. 문제 정의 및 아이디어 요청

**사용자:**
논문 검색할때 해당 주제에 대해서 잘 모를때가 있다. 어떤 논문들을 읽어야할지 돕고 싶다. 예를들어 Accelerating Scientific Research with Gemini: Case Studies and Common Techniques 라는 논문을 알게되었고 이 논문을 기반으로 어떤 Accelerating Scientific Research 관련해서 어떤 연구들이 있는지 탐색하는거지. 검색 결과로 나오는 많은 논문들을 어떻게 분류해야할지 그리고 후속 검색 키워드는 어떻게 찾아야할지 등등이 어려운 부분이다. 이부분을 돕는 기능을 추가하고 싶은데 여러가지 아이디어를 검토하고 제안하라.

---

## 2. 아이디어 제안

**어시스턴트:**
코드베이스 전체를 파악했다. 현재 구조와 문제점을 기반으로 아이디어를 정리하겠다.

현재 Moon Search Light의 흐름은 **사용자가 이미 뭘 찾을지 알고 있다**는 전제에 기반한다.

```
검색 → (평면적 결과 목록) → 수동 선택 → 분석
```

하지만 실제 연구 탐색은 이렇게 진행된다:

```
하나의 논문 발견 → "이 분야가 뭐지?" → 분류 필요 → 방향 설정 → 깊은 탐색
```

현재 이 **"분류"와 "방향 설정"** 단계를 지원하는 기능이 없다.

**5가지 아이디어 제안:**

1. **Topic Clustering** — 검색 결과를 AI가 하위 주제별로 묶어서 보여주는 기능. API 1회 호출.
2. **Suggested Keywords** — 검색 결과를 분석해서 후속 검색 키워드 5~8개 제안. API 1회.
3. **Reading Guide** — 어떤 순서로 읽어야 하는지 AI가 안내 (기초 → 방법론 → 최신). API 1회.
4. **Seed Paper Mode** — 시드 논문에서 핵심 개념 추출 → 자동 다중 검색 → 통합 클러스터링. API 3~5회, 가장 강력하지만 비용 큼.
5. **Exploration Paths** — 3~4개 탐색 방향 도출 + 추천 검색어 + 대표 논문. API 1회.

**조합 제안:**

| 조합 | 설명 | 구현 난이도 |
|------|------|------------|
| 2+1: 키워드 제안 + 클러스터링 | 검색 후 결과를 분류하고 다음 검색어 제안 | 중간 |
| 4+1+3: 시드 모드 + 클러스터링 + 읽기 가이드 | 논문 하나에서 출발하여 전체 지형 파악 | 높음 |
| 5+2: 탐색 경로 + 키워드 제안 | 방향 제시 + 즉시 실행 가능한 키워드 | 낮음 |

---

## 3. 문서 저장

**사용자:**
일단 문서로 저장

**어시스턴트:**
`docs/research-guide-ideas.md`에 저장했다. 방향 정해지면 이어서 진행하면 된다.

---

## 4. 제약사항 정의 원칙

**사용자:**
작업을 하기전에는 항상 제약사항을 정하고 가야한다. 기억해둬

**어시스턴트:**
맞는 말이다. 기억해두겠다. 앞으로 작업 전에 제약사항부터 정리하고 들어가겠다.

---

## 5. 제약사항 논의

**사용자:**
그럼 이 기능의 제약사항부터 정리해보자

**어시스턴트:**
좋다. 몇 가지 확인이 필요한 부분이 있다.

*[구조화된 질문 4개를 제시]*

**질문 1 — API 비용:**
- 최소화 (추가 API 1~2회)
- 적당히 (3~5회)
- 효과 우선

**질문 2 — 응답 속도:**
- 3초 이내
- 5~10초 (로딩 UI 동반)
- 비동기 허용

**질문 3 — 첫 구현 범위:**
- 단일 기능
- 핵심 조합 (2~3개)
- 풀 패키지

**질문 4 — 기존 UI 구조:**
- 기존 구조 유지
- 새 영역 허용
- 별도 페이지 가능

**사용자 답변:**
- API 비용: "고성능 추론 모델 말고 가볍지만 효과적인 모델을 적극적으로 사용한다. (가격도 저렴)"
- 응답 속도: "5~10초"
- 구현 범위: "핵심 조합"
- UI 제약: "contexts/ 폴더의 기능들처럼 모듈화하여 관리하자"

**어시스턴트:**
제약사항 정리했다.

- **비용**: 가벼운 모델 사용, 고비용 추론 모델 배제
- **속도**: 5~10초 이내, 로딩 UI 동반
- **범위**: 핵심 2~3개 기능 조합으로 의미 있는 플로우 구성
- **아키텍처**: 기존 features 모듈 패턴 + contexts 문서 동기화 준수
- **데이터**: 이미 확보된 검색 결과 데이터 최대한 재활용

이 제약사항 기준으로 어떤 조합을 가져갈지 결정하면 된다. 어떤 방향이 끌려?

---

## 6. 모델 선택

**사용자:**
LLM 모델은 gemini-3-flash-preview 를 사용할거야.

**어시스턴트:**
반영했다. 기존 프로젝트에서는 OpenAI(gpt-4o-mini)를 쓰고 있는데, 이 기능에서만 Gemini를 쓸 건지 아니면 앞으로 전체를 Gemini로 전환할 계획인지 확인해도 될까?

**사용자:**
일단은 이 기능만 Gemini 쓰고, 나머지는 그대로 유지

> **후속 업데이트**: 이후 전체 AI 기능(요약/번역/채팅 등)이 OpenAI → Google Gemini(`gemini-3-flash-preview`)로 마이그레이션됨. "이 기능 한정"이라는 제약은 더 이상 유효하지 않음.

**어시스턴트:**
반영했다. 그러면 Gemini SDK 의존성이 새로 추가되는 점도 제약사항에 포함되는 셈이다. 조합 방향을 정하면 다음으로 넘어갈 수 있다. 어떤 조합으로 갈까?

---

## 7. 기능 조합 및 난이도 논의

**사용자:**
조합은 4+1 로 하려고하는데 이러면 구현 난이도가 낮아질까?

**어시스턴트:**
솔직히 말하면, **4+1+3에서 "높음"이었던 이유의 대부분은 Seed Paper Mode(4) 자체**에 있다. Reading Guide(3)를 빼면 줄어들긴 하지만, 핵심 난이도는 크게 안 변한다.

**4(Seed Paper)가 무거운 이유:**
- 시드 논문에서 핵심 개념 추출 → Gemini 호출 1회
- 개념별 Semantic Scholar 검색 자동 실행 → 3~5회 API 호출
- 여러 검색 결과를 합치고 중복 제거하는 로직
- 합쳐진 결과에 클러스터링(1) 적용 → Gemini 호출 1회
- 이 전체 흐름을 관리하는 상태 관리 + UI

**1(Clustering)만 놓고 보면** API 1회 호출에 결과를 그룹핑하는 거라 난이도가 낮다.

그래서 4+1 조합은 **"중간~높음"** 정도로 보면 된다. 4+1+3 대비 약간 줄었을 뿐 극적으로 낮아지진 않아.

만약 난이도를 확실히 낮추고 싶다면 두 가지 선택지가 있다:
- **1+2 (클러스터링 + 키워드 제안)**: 검색 결과 기반으로만 동작. Seed 없이도 충분히 유용하고, 난이도 중간
- **Seed를 간소화**: 자동 다중 검색 대신, 시드 논문에서 키워드만 추출해서 사용자가 직접 선택하여 검색하는 방식

어떻게 할까?

---

## 8. 최종 방향 결정: Seed 간소화

**사용자:**
시드 간소화 방식으로 가자. 이게 사용자 경험 측면에서 블랙박스가 없고 통제력이 있어서 좋은점이 있다.

**어시스턴트:**
좋은 판단이다. 사용자가 매 단계에서 뭐가 일어나는지 보고 선택할 수 있는 게 훨씬 낫다.

> **결정 요약**: Seed Paper Mode를 간소화하여, 자동 다중 검색 대신 키워드만 추출 → 사용자가 직접 선택하여 검색하는 방식으로 결정. 조합은 **4(간소화) + 1(Clustering)**.

---

## 9. 설계 진행 전 추가 제약 확인

**사용자:**
이 과정에서 제약사항 설정이 필요할까?

**어시스턴트:**
지금까지 정의한 제약사항(모델, 속도, 아키텍처 등)으로 충분하다고 본다. 추가로 정할 만한 게 있다면 **시드 간소화 방식에 특화된 것** 정도인데:

- 키워드 추출 개수 제한 (3~5개? 5~8개?)
- 클러스터 수 제한 (3~6개?)
- 시드 논문 지정 방식 (선택된 논문 중에서? 별도 입력?)

이런 건 설계 단계에서 자연스럽게 정해질 수준이라, 별도로 제약사항을 추가하기보다 **바로 설계로 넘어가도** 괜찮다고 생각한다.

추가로 잡아두고 싶은 제약이 있어?

**사용자:**
없어 설계 들어가자

---

## 10. 설계 및 구현 문서 보완

*[설계 작업 후 plan mode에서 상세 설계 완료. 아래는 문서화 논의]*

**어시스턴트:**
`docs/research-guide-ideas.md`에 최종 결정 사항까지 모두 반영했다. 구현 들어갈 준비가 되면 말해.

**사용자:**
구현은 새로운 세션에서 하려고해. 이 문서를 기반으로 작업을 할건데 더 추가할게 있을까?

**어시스턴트:**
새 세션에서 이 문서만 보고 구현하려면 몇 가지 빠져 있다.

1. **핵심 타입 정의** — ResearchKeyword, Cluster 등의 구체적 필드 정의
2. **API 요청/응답 예시** — 실제 JSON 형태
3. **훅 인터페이스** — useResearchGuide가 노출하는 것들
4. **트리거 규칙** — 키워드 검색일 때만 클러스터링, 5개 미만 미실행 등
5. **엣지 케이스** — abstract 없는 논문, 시드 교체 시 abort, 세션 복원
6. **검증 방법** — 어떻게 테스트할지

플랜 파일에는 이 내용이 다 있으니 문서에 합치겠다.

*[문서에 상세 내용 추가 완료]*

**어시스턴트:**
추가했다. 이제 문서에 새 세션에서 구현에 필요한 내용이 모두 담겨 있다:

- 핵심 타입 정의
- API 요청/응답 예시 (JSON)
- 훅 인터페이스
- 트리거 규칙 (언제 뭐가 호출되는지)
- 엣지 케이스
- 구현 순서
- 검증 방법

더 추가하고 싶은 내용 있어?

---

## 11. 구현 방식 결정

**사용자:**
아니면 니가 서브에이전트에게 구현을 지시하고 주요 검토사항만 나와 점검하는건 어때?

**어시스턴트:**
좋은 방식이다. 내가 서브에이전트에 구현을 맡기고, 주요 결정이 필요하거나 검토가 필요한 포인트만 너한테 가져오는 구조로 하면 효율적이다.

진행 방식은 이렇게 되겠다:

1. Phase별로 서브에이전트에게 구현 지시
2. 결과물 확인 후 주요 검토사항만 너한테 보고
3. 너의 피드백 반영 후 다음 Phase 진행

이대로 진행할까?

---

## 의사결정 요약

| 항목 | 결정 | 근거 |
|------|------|------|
| 기능 조합 | 4(Seed 간소화) + 1(Clustering) | 블랙박스 없이 사용자 통제력 유지 |
| LLM 모델 | gemini-3-flash-preview | 가볍고 저렴, 전체 AI 기능 동일 모델 |
| 응답 속도 | 5~10초 이내 | 로딩 UI 동반 |
| 구현 범위 | 핵심 조합 (2~3개 기능) | 사용자 여정을 커버하는 조합 |
| 아키텍처 | 기존 features 모듈 패턴 준수 | contexts 문서 동기화 포함 |
| Seed 방식 | 키워드 추출만 → 사용자 선택 → 검색 | 자동 다중 검색 대비 투명성 확보 |
| 구현 진행 | 서브에이전트에 위임, 주요 포인트만 사용자 점검 | 효율적 협업 |
