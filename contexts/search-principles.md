# Search 모듈 - 원칙

> 동기화 대상: `app/features/search/principles.ts`

---

## 1. 데이터 소스

| 항목 | 값 |
|------|-----|
| API | Semantic Scholar |
| 논문 수 | 2억+ 건 |
| 기본 필드 | title, abstract, year, authors, citationCount, url, externalIds |

---

## 2. 검색 제한

| 항목 | 값 |
|------|-----|
| 최대 결과 | 100개 |
| 초기 표시 | 20개 |
| 추가 로드 | 20개씩 |

---

## 3. 정렬 옵션

| 옵션 | 설명 | UI 라벨 |
|------|------|---------|
| `recommended` | 연도 + 인용수 가중치 | 추천순 |
| `relevance` | 선택 논문과 벡터 유사도 | 관련성 |
| `year-desc` | 최신순 | 최신순 |
| `year-asc` | 오래된순 | 오래된순 |
| `citations` | 인용수 내림차순 | 인용순 |

---

## 4. 추천순 알고리즘

### 4.1 가중치 배분

| 요소 | 가중치 |
|------|--------|
| 연도 점수 | 60% |
| 인용수 점수 | 40% |

### 4.2 연도 점수

| 연도 범위 | 점수 |
|-----------|------|
| 0-1년 | 1.0 |
| 1-5년 | 0.8 |
| 5-10년 | 0.5 |
| 10-15년 | 0.25 |
| 15년+ | 0.1 |

### 4.3 인용수 점수

```
citationScore = log10(citations + 1) / 5
```

- 로그 스케일로 극단값 완화
- 5로 나누어 0~1 범위로 정규화

---

## 5. 쿼리 유형 감지

### 5.1 구체적 쿼리 조건

- 4개 이상 단어
- 따옴표 포함
- 50자 이상 (논문 제목일 가능성)

### 5.2 정렬 방식

| 쿼리 유형 | 정렬 우선순위 |
|-----------|--------------|
| 구체적 | 정확 일치 > 포함 > 인용수 |
| 단순 | 인용수만 |

---

## 6. 텍스트 정규화

```
1. 소문자 변환
2. 특수문자 제거 (영숫자, 공백만 유지)
3. 앞뒤 공백 제거
```

---

## 7. 에러 처리

| 상황 | 대응 |
|------|------|
| 쿼리 없음 | 400 에러 |
| API 실패 | 500 에러, PostHog 기록 |

---

## 8. API 키

- 환경변수: `S2_API_KEY`
- 선택적: 없으면 공개 API 사용

---

## 핵심 원칙 요약

1. **Semantic Scholar**: 2억+ 논문 데이터베이스
2. **스마트 정렬**: 최신성(60%) + 인용수(40%)
3. **쿼리 감지**: 구체적 쿼리는 제목 매칭 우선
4. **점진적 로드**: 20개씩 표시
5. **로그 스케일**: 인용수 극단값 완화

---

> **동기화 지침**: 이 문서를 수정하면 `app/features/search/principles.ts`도 함께 수정해야 합니다.
